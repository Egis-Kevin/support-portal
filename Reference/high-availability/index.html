<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>High availability - Support Portal</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../iconmoon.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../..">Support Portal</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../..">Home</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Configuration <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../Configuration/Advanced Login/">Advanced Login</a>
</li>
                            
<li >
    <a href="../../Configuration/Advanced Permissions/">Advanced Permissions</a>
</li>
                            
<li >
    <a href="../../Configuration/Backups/">Backups</a>
</li>
                            
<li >
    <a href="../../Configuration/Barcode/">Barcode</a>
</li>
                            
<li >
    <a href="../../Configuration/Branding/">Branding</a>
</li>
                            
<li >
    <a href="../../Configuration/Logging/">Logging</a>
</li>
                            
<li >
    <a href="../../Configuration/SSO/">SSO</a>
</li>
                            
<li >
    <a href="../../Configuration/Template Extraction/">Template Extraction</a>
</li>
                            
<li >
    <a href="../../Configuration/User Management/">User Management</a>
</li>
                            
<li >
    <a href="../../Configuration/WebScan/">WebScan</a>
</li>
                            
<li >
    <a href="../../Configuration/Yaml Config/">Yaml Config</a>
</li>
                            
<li >
    <a href="../../Configuration/indexes/">Indexes</a>
</li>
                            
<li >
    <a href="../../Configuration/security/">Security</a>
</li>
                            
<li >
    <a href="../../Configuration/ssl/">Ssl</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Installation <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../Installation/CLI/">CLI</a>
</li>
                            
<li >
    <a href="../../Installation/Desktop Agent/">Desktop Agent</a>
</li>
                            
<li >
    <a href="../../Installation/MS Office Add-in/">MS Office Add in</a>
</li>
                            
<li >
    <a href="../../Installation/Sizing/">Sizing</a>
</li>
                            
<li >
    <a href="../../Installation/Ubuntu-Linux/">Ubuntu Linux</a>
</li>
                            
<li >
    <a href="../../Installation/Windows/">Windows</a>
</li>
                            
<li >
    <a href="../../Installation/end-user-installation/">End user installation</a>
</li>
                            
<li >
    <a href="../../Installation/macosx/">Macosx</a>
</li>
                            
<li >
    <a href="../../Installation/server-installation/">Server installation</a>
</li>
                            
<li >
    <a href="../../Installation/service/">Service</a>
</li>
                            
<li >
    <a href="../../Installation/solution/">Solution</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Integration <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../Integration/Database/">Database</a>
</li>
                            
<li >
    <a href="../../Integration/EasyPDF/">EasyPDF</a>
</li>
                            
<li >
    <a href="../../Integration/Folder Export/">Folder Export</a>
</li>
                            
<li >
    <a href="../../Integration/data-sources/">Data sources</a>
</li>
                            
<li >
    <a href="../../Integration/email-watch/">Email watch</a>
</li>
                            
<li >
    <a href="../../Integration/folder-watch/">Folder watch</a>
</li>
                            
<li >
    <a href="../../Integration/ldap-ad/">Ldap ad</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../Cold Standby Failover Procedure/">Cold Standby Failover Procedure</a>
</li>
                            
<li >
    <a href="../Encryption/">Encryption</a>
</li>
                            
<li >
    <a href="../Linking/">Linking</a>
</li>
                            
<li >
    <a href="../Logging/">Logging</a>
</li>
                            
<li >
    <a href="../System-Nodes/">System Nodes</a>
</li>
                            
<li >
    <a href="../document-properties/">Document properties</a>
</li>
                            
<li >
    <a href="../health/">Health</a>
</li>
                            
<li class="active">
    <a href="./">High availability</a>
</li>
                            
<li >
    <a href="../licensing/">Licensing</a>
</li>
                            
<li >
    <a href="../linking_syntax/">Linking syntax</a>
</li>
                            
<li >
    <a href="../maintenance/">Maintenance</a>
</li>
                            
<li >
    <a href="../pql/">Pql</a>
</li>
                            
<li >
    <a href="../regex/">Regex</a>
</li>
                            
<li >
    <a href="../standard_expression/">Standard expression</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Troubleshooting <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../Troubleshooting/Performance/">Performance</a>
</li>
                            
<li >
    <a href="../../Troubleshooting/Troubleshooting Client/">Troubleshooting Client</a>
</li>
                            
<li >
    <a href="../../Troubleshooting/Troubleshooting Server/">Troubleshooting Server</a>
</li>
                            
<li >
    <a href="../../Troubleshooting/cpu-usage/">Cpu usage</a>
</li>
                            
<li >
    <a href="../../Troubleshooting/db-tuning/">Db tuning</a>
</li>
                            
<li >
    <a href="../../Troubleshooting/exceptions/">Exceptions</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../health/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../licensing/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#high-availability">High Availability</a></li>
            <li><a href="#master-node">Master Node</a></li>
            <li><a href="#file-replication">File Replication</a></li>
            <li><a href="#index-replication">Index Replication</a></li>
            <li><a href="#replication">Replication</a></li>
            <li><a href="#clustering">Clustering</a></li>
            <li><a href="#cold-standby">Cold Standby</a></li>
            <li><a href="#warm-standby">Warm Standby</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="high-availability">High Availability</h1>
<p>PaperTrail support 4 distinct modes of HA operation:</p>
<ol>
<li>Replication</li>
<li>Clustering</li>
<li>Cold/Warm Standby</li>
</ol>
<h3 id="master-node">Master Node</h3>
<p>Whether using replication or clustering, which node is configured as master will matter is it is responsible for running a number of background jobs including:</p>
<ul>
<li>workflow and allocation timeouts</li>
<li>scheduled rules</li>
<li>out of office start/end</li>
<li>diarize start</li>
<li>reminders</li>
</ul>
<p>Should the master fail, a new master needs to be configured.</p>
<p><strong>Email</strong> and <strong>Folder</strong> watches are configured per server/node so that load can be manually balanced, should a node fail, then the watches that were configured for it will need to be manually moved.</p>
<h3 id="file-replication">File Replication</h3>
<p>PaperTrail has a builtin file replication engine that supports both <strong>master-master</strong> and <strong>master-slave</strong> it is configued by specifying:
 <code>file.replication.upstream=http://slave:8080</code></p>
<p>In the background this configures 2 File/Blob stores:</p>
<ol>
<li>A sync local filesystem store (only a single sync store is supported and is considered the primary)</li>
<li>An async persistent sencondary store   </li>
</ol>
<blockquote>
<p><strong>Async</strong> stores fully support intermittent WAN connections and will retry all operations. All operations are queued under the <code>{store name}.write</code> and  <code>{store name}.delete</code> message queues</p>
</blockquote>
<p>Their are 2 alternatives to full replication of files:</p>
<ol>
<li>configure the slave or secondary members to read/write files from the master using a <strong>HTTP</strong> store as the primary sync store. It is recommended to enable <strong>WORM</strong> (Write once read many) on secondary nodes </li>
<li>Use an object storage platform like Amazon S3 and have all members use it as the primary </li>
</ol>
<blockquote>
<p>PaperTrail needs low latency access to the primary sync file store so if you are using Amazon S3 ensure that PaperTrail is hosted in the same AWS region as the  S3 bucket.</p>
</blockquote>
<h3 id="index-replication">Index Replication</h3>
<p>Specifing a slave server for <code>index.upstream</code> will only work for 2 node clusters, for 2+ nodes switch to messaging based replication using:</p>
<pre><code>index.upstream=topic
</code></pre>

<p>It is recommended in both scenarios to setup a scheduled <code>index_repair</code> task.</p>
<h2 id="replication">Replication</h2>
<p><img alt="replication" src="../../images/ha-replication.png" /></p>
<p>To convert a standalone installation to a replicated installation, follow these steps:  </p>
<ul>
<li>Stop PaperTrail and create a <strong>database backup</strong>.  </li>
<li>Configure the following properties in <strong>papertrail.properties</strong> on the master</li>
</ul>
<pre><code class="javascript">index.upstream=http://slave:8080
replication.upstream=http://slave:8080  
file.replication.upstream=http://host:8080  
replication.master=true  
replication.increment=2  
replication.offset=1  
db.identity.override=true # for sql server replication only  
</code></pre>

<ul>
<li>Configure these properties on the slave:  </li>
</ul>
<pre><code class="javascript">index.upstream=http://master:8080  
replication.upstream=http://master:8080
file.replication.upstream=http://master:8080  
replication.master=false  
replication.increment=2  
replication.offset=2  
db.identity.override=true # for sql server replication only  
</code></pre>

<ul>
<li>Start up the master</li>
<li>Wait a few minutes and start up the slave</li>
</ul>
<h2 id="clustering">Clustering</h2>
<p><img alt="replication" src="../../images/ha-clustering.png" /></p>
<blockquote>
<p>Note: Clustering requires a low latency (&lt;1ms), reliable (preferably dual path redundant network) network connection to function correctly.  Replication can be used in WAN environments.</p>
</blockquote>
<ol>
<li>Ensure that port <code>5701</code> is open for inbound traffic from all cluster members to all cluster members. See <a href="http://docs.hazelcast.org/docs/3.3/manual/html/ports.html">Hazelcast Ports</a></li>
<li>Add these properties to the <strong>papertrail.properties</strong>  </li>
</ol>
<pre><code>index.upstream=http://slave:8080
cluster.enable=true
file.replication.upstream=http://slave:8080  
</code></pre>

<ol>
<li>Restart PaperTrail.</li>
</ol>
<h3 id="shared-db-vs-replication-db">Shared DB vs Replication DB</h3>
<h2 id="cold-standby">Cold Standby</h2>
<p><img alt="replication" src="../../images/ha-cold.png" /></p>
<p>Indexes are not replicated and PaperTrail is only started in file store replication receive mode. Failover requires re-configuration of PaperTrail for full operation + rebuilding indexes.</p>
<h2 id="warm-standby">Warm Standby</h2>
<p><img alt="replication" src="../../images/ha-standby.png" /></p>
<p>Everything is replicated in near realtime, and PaperTrail is started in read only mode. Failover requires restarting PaperTrail in read/write mode. </p></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2016 Egis Software</p>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>
        <script src="../../extra.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
